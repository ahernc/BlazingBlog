@page "/"
@attribute [StreamRendering]
@inject ISender Sender

<PageTitle>Articles</PageTitle>

<div class="space-y-4">
    <h2 class="text-2xl font-extrabold text-gray-100">Articles</h2>
    
    <div>
        <a href="/article-editor" class="p-3 text-sm font-bold tracking-wide uppercase rounded bg-blue-600 text-gray-900 inline-block">Create new Article</a>
    </div>

    @if (articles is null)
    {
        <p><em>Loading articles....</em></p>
    }
    else if (articles.Count == 0)
    {
        <p><em>No articles found</em></p>
    }
    else
    {
        <ul class="space-y-8 xl:space-y-10">
            @foreach (var article in articles)
            {
                <li>
                    <dl>
                        <dt class="sr-only">Published on</dt>
                        <dd class="text-xs text-gray-200">
                            <time datetime="@article.DatePublished">@article.DatePublished</time>
                        </dd>
                    </dl>
                    <div class="space-y-1">
                        <h3 class="text-2xl font-bold tracking-tight">
                            <a href="#" class="text-gray-100">@article.Title</a>
                        </h3>
                        <p class="max-w-full text-gray-100 prose prose-invert">@article.Content</p>
                        <div class="flex flex-wrap space-x-3">
                            <a href="/article-editor/@article.Id" class="text-xs text-green-600">Edit</a>
                        </div>
                    </div>
                </li>
            }
        </ul>
    }
</div>

@code {
    private List<ArticleResponse>? articles;

    protected async override Task OnInitializedAsync()
    {
        var result = await Sender.Send(new GetArticlesQuery());
        if (result.Success)
        {
            articles = result;
        }
        else
        {
            articles = new();
        }
    }
}
